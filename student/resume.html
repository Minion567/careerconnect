<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Resume Tool - Create & Analyze</title>
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <style>
        :root{
            --primary:#2d6ca2;
            --secondary:#3498db;
            --muted:#7f8c8d;
            --success:#27ae60;
            --danger:#c0392b;
            --purple:#8e44ad;
            --light-bg:#f4f7fb;
            --card-bg: rgba(255,255,255,0.88);
        }

        html,body{
            margin:0;
            padding:0;
            height:100%;
            font-family: 'Segoe UI', Roboto, Inter, system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #eaf6ff, #f6f8fb);
            color:#222;
            -webkit-font-smoothing:antialiased;
            -moz-osx-font-smoothing:grayscale;
        }

        /* Layout for Builder */
        #builder-app {
            display: none;
            height: 100%;
            display:flex;
            gap:0;
            align-items:stretch;
            padding:18px;
        }
        .form-section, .preview-wrap{
            flex:1;
            min-width:320px;
            box-sizing:border-box;
            overflow:auto;
        }
        .form-section{
            margin-right:12px;
            background:var(--card-bg);
            border-radius:14px;
            padding:22px;
            box-shadow:0 8px 28px rgba(14,35,64,0.08);
            border:1px solid rgba(0,0,0,0.03);
        }
        .preview-wrap{
            margin-left:12px;
            padding:22px;
        }

        /* Welcome Page Styles */
        #welcome-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
            text-align: center;
        }
        .welcome-buttons {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }
        .welcome-buttons button {
            padding: 15px 30px;
            font-size: 18px;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: transform .12s, box-shadow .12s;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
        }
        .welcome-buttons button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(0,0,0,0.1);
        }
        #create-btn {
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            color: #fff;
        }
        #analyze-btn {
            background: linear-gradient(90deg, var(--success), #29b85f);
            color: #fff;
        }
        #welcome-screen h1 {
            font-size: 36px;
            color: #1b2b3a;
            margin-bottom: 10px;
        }
        #welcome-screen p {
            font-size: 18px;
            color: var(--muted);
        }

        /* Resume Analyzer Screen */
        #analyzer-screen {
            display: none;
            justify-content: center;
            align-items: center;
            height: 100vh;
            flex-direction: column;
            text-align: center;
            padding: 20px;
        }
        #analyzer-screen h1 {
            color: var(--primary);
            margin-bottom: 20px;
        }
        .analyzer-content {
            background: var(--card-bg);
            padding: 40px;
            border-radius: 14px;
            box-shadow: 0 8px 28px rgba(14,35,64,0.08);
            max-width: 600px;
            width: 100%;
        }
        #analyzer-screen input[type="file"] {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            padding: 10px;
        }
        .back-to-welcome {
            background: var(--muted);
            color: #fff;
            margin-top: 30px;
        }

        /* --- New Styles for Analysis Results --- */
        #analysis-results-screen {
            display: none;
            padding: 20px;
            height: 100vh;
            overflow-y: auto;
        }
        .results-container {
            max-width: 900px;
            width: 100%;
            margin: 30px auto;
            background: #fff;
            border-radius: 16px;
            box-shadow: 0 12px 40px rgba(14, 35, 64, 0.1);
            padding: 30px;
        }
        .results-container h1 {
            color: var(--primary);
            border-bottom: 2px solid #eef6fb;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .score-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-radius: 12px;
            background: var(--light-bg);
            margin-bottom: 30px;
        }
        .score-card .score {
            font-size: 48px;
            font-weight: 800;
            color: var(--success);
            margin-right: 20px;
        }
        .score-card .summary h2 {
            margin: 0;
            font-size: 22px;
            color: #1b2b3a;
        }
        .score-card .summary p {
            margin: 5px 0 0;
            color: var(--muted);
        }
        .ats-section h3 {
            color: var(--purple);
            font-size: 18px;
            margin-top: 20px;
            margin-bottom: 10px;
            padding-left: 10px;
            border-left: 4px solid var(--purple);
        }
        .feedback-item {
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            display: flex;
            align-items: flex-start; /* Aligns content to top if multiple lines */
            background: #f7f9fc;
            font-size: 14px;
        }
        .feedback-item .icon {
            font-size: 20px;
            margin-right: 15px;
            flex-shrink: 0; /* Prevents icon from shrinking */
        }
        .feedback-item.pass {
            border: 1px solid var(--success);
        }
        .feedback-item.fail {
            border: 1px solid var(--danger);
        }
        .feedback-item.warning {
            border: 1px solid #f39c12; /* Orange */
        }
        
        /* Resume Builder Styles */
        h2{margin:0 0 14px 0;font-size:20px;color:#1b2b3a;font-weight:700}
        label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px;font-weight:600}

        /* Inputs */
        .grid-two{display:grid;grid-template-columns:1fr 1fr;gap:12px}
        input, textarea, select {
            width:100%;
            padding:10px 12px;
            margin:6px 0 14px 0;
            border-radius:10px;
            border:1px solid #e3e9ee;
            box-sizing:border-box;
            font-size:14px;
            background:#fff;
            transition:box-shadow .18s, border-color .18s, transform .1s;
        }
        input:focus, textarea:focus{
            border-color:var(--secondary);
            outline:none;
            box-shadow:0 6px 18px rgba(52,152,219,0.12);
            transform:translateY(-1px);
        }
        textarea{min-height:80px;resize:vertical}

        /* Style selector */
        .style-selector{display:flex;gap:12px;margin-bottom:16px}
        .style-option{
            width:120px;
            padding:8px;
            border-radius:10px;
            cursor:pointer;
            background:#fff;
            text-align:center;
            border:2px solid transparent;
            box-shadow:0 6px 16px rgba(14,35,64,0.05);
            transition:transform .18s, box-shadow .18s, border-color .18s;
            user-select:none;
        }
        .style-option img{width:100%;height:74px;object-fit:cover;border-radius:6px;display:block;margin-bottom:6px}
        .style-option:hover{transform:translateY(-3px)}
        .style-option.active{border-color:var(--secondary);box-shadow:0 10px 28px rgba(52,152,219,0.12)}

        /* Stepper */
        .stepper{
            display:flex;
            gap:8px;
            margin-bottom:12px;
            align-items:center;
        }
        .step-indicator{
            flex:1;
            height:8px;
            background:#e6eef6;
            border-radius:6px;
            overflow:hidden;
            position:relative;
        }
        .step-indicator.active::after{
            content:"";
            position:absolute;
            top:0;left:0;bottom:0;
            width:100%;
            background:linear-gradient(90deg,var(--secondary),var(--primary));
        }
        .step-labels{font-size:12px;color:var(--muted);display:flex;justify-content:space-between;margin-bottom:10px}

        /* Buttons */
        .controls-row{display:flex;gap:10px;margin-top:6px;flex-wrap:wrap}
        button{
            padding:10px 14px;
            border:0;
            border-radius:10px;
            cursor:pointer;
            font-weight:700;
            font-size:14px;
            letter-spacing:.2px;
            transition:transform .12s, box-shadow .12s, opacity .12s;
        }
        button:active{transform:translateY(1px)}
        .next{background:linear-gradient(90deg,var(--secondary),var(--primary));color:#fff;box-shadow:0 8px 18px rgba(52,152,219,0.12)}
        .back{background:#95a5a6;color:#fff}
        .download{background:linear-gradient(90deg,#2ecc71,#27ae60);color:#fff}
        .add{background:linear-gradient(90deg,var(--purple),#7a3ea6);color:#fff}
        .remove{background:linear-gradient(90deg,var(--danger),#e74c3c);color:#fff}

        /* Small utilities */
        .muted{color:var(--muted);font-size:13px}
        hr{border:0;border-top:1px dashed #eef3f7;margin:12px 0}

        /* Resume preview base */
        #resumePreview{
            max-width:920px;
            margin:0 auto;
            border-radius:12px;
            overflow:hidden;
            background:#fff;
            box-shadow:0 10px 36px rgba(14,35,64,0.08);
        }
        #resumePreview .resume-inner{
            display:grid;
            grid-template-columns:220px 1fr;
            gap:0;
            align-items:start;
            min-height:320px;
        }
        /* Left column visual */
        #resumePreview .left-col{
            background:linear-gradient(180deg,var(--primary),#1b4f76);
            color:#fff;
            padding:26px 18px;
            text-align:center;
            display:flex;
            flex-direction:column;
            align-items:center;
            gap:10px;
        }
        #resumePreview .left-col .profile-pic{
            width:118px;height:118px;border-radius:50%;object-fit:cover;border:3px solid rgba(255,255,255,0.95)
        }
        #resumePreview .left-col h1{margin:6px 0 0;font-size:20px}
        #resumePreview .left-col h2{margin:0;font-size:13px;color:rgba(255,255,255,0.9);font-weight:600}
        #resumePreview .left-col p.meta{margin:6px 0 0;color:rgba(255,255,255,0.8);font-size:13px}

        /* Right column */
        #resumePreview .right-col{
            padding:26px 30px;
            color:#2c3e50;
            background:linear-gradient(180deg,#fff,#fbfdff);
        }
        .section{margin-bottom:14px}
        .section h3{font-size:15px;margin:0 0 8px;color:var(--primary);font-weight:800;border-bottom:1px solid #eef6fb;padding-bottom:6px}
        .section p, .section li{font-size:13px;color:#333;margin:8px 0;line-height:1.45}

        /* alternate styles (thumbnails) */
        #resumePreview.style2 .resume-inner{
            grid-template-columns:1fr;
        }
        #resumePreview.style2 .left-col{
            background:#fff;
            color:#111;
            padding:18px;
            flex-direction:row;
            gap:12px;
            align-items:center;
            justify-content:flex-start;
        }
        #resumePreview.style2 .left-col .profile-pic{width:86px;height:86px;border-radius:10px;border:2px solid #111}
        #resumePreview.style2 .left-col h1{font-size:22px;color:#111;text-transform:uppercase;letter-spacing:1px}
        #resumePreview.style2 .right-col{padding-top:18px;border-top:1px solid #e9eef3}

        /* style3: modern accent bar */
        #resumePreview.style3{border-left:8px solid #2c3e50}
        #resumePreview.style3 .left-col{display:none}
        #resumePreview.style3 .right-col{padding:28px 34px}
        #resumePreview.style3 .right-col h1{font-size:26px;color:#2c3e50;margin-top:0}

        /* responsive */
        @media(max-width:980px){
            body{padding:0} 
            #builder-app{flex-direction:column;padding:14px;}
            .form-section{margin:0 0 12px 0}
            .preview-wrap{margin:0}
            #resumePreview .resume-inner{grid-template-columns:1fr}
            #resumePreview .left-col{flex-direction:row;justify-content:flex-start;padding:14px}
            #resumePreview .left-col .profile-pic{width:86px;height:86px;border-radius:10px}
            #resumePreview .right-col{padding:18px}
        }
    </style>
</head>
<body>

    <div id="welcome-screen">
        <h1>Welcome to Your Resume Tool 🚀</h1>
        <p>Choose an action to get started: Create a new, ATS-friendly resume or analyze your existing one.</p>
        <div class="welcome-buttons">
            <button id="create-btn" onclick="showScreen('builder')">Create Resume</button>
            <button id="analyze-btn" onclick="showScreen('analyzer')">Analyze Resume</button>
        </div>
        <a href="./index.html">
        <button class="back back-to-welcome" onclick="showScreen('welcome')" style="align-items: center;">Back to Home</button>
        </a>
    </div>

    <div id="analyzer-screen">
        <div class="analyzer-content">
            <h1>📄 ATS Resume Analyzer</h1>
            <p>Upload your resume (PDF or DOCX) for an AI-powered ATS check.</p>
            <input type="file" id="analyzerFileInput" accept=".pdf,.docx" aria-label="Upload Resume for Analysis">
            <button class="next" id="analyzeNowButton">Analyze Now</button>
            <p class="muted" style="margin-top:15px;">*This feature would typically integrate with an AI backend to provide ATS results.</p>
        </div>
        <button class="back back-to-welcome" onclick="showScreen('welcome')">Back to Home</button>
    </div>

    <div id="analysis-results-screen">
        <div class="results-container">
            <h1>ATS Analysis Report 🤖</h1>
            
            <div class="score-card">
                <div class="summary">
                    <h2>Overall ATS Score:</h2>
                    <p>Your score reflects how easily Applicant Tracking Systems can parse and rank your resume.</p>
                </div>
                <div class="score" id="atsScore">82/100</div> 
            </div>

            <div class="ats-section">
                <h3>✅ Formatting & Structure</h3>
                <div id="formattingResults">
                    <div class="feedback-item pass">
                        <span class="icon" style="color:var(--success);">✅</span>
                        <div>**Font/Layout:** Uses standard, readable fonts (e.g., Arial, Calibri). Single column layout used.</div>
                    </div>
                    <div class="feedback-item pass">
                        <span class="icon" style="color:var(--success);">✅</span>
                        <div>**Section Headings:** Standard headings (Experience, Education, Skills) are clearly identifiable.</div>
                    </div>
                    <div class="feedback-item warning">
                        <span class="icon" style="color:#f39c12;">⚠️</span>
                        <div>**Graphic Elements:** Detected a photo or complex graphic. While visually appealing, these can sometimes confuse older ATS systems.</div>
                    </div>
                </div>
            </div>

            <div class="ats-section">
                <h3>🎯 Keyword & Content Optimization</h3>
                <div id="keywordResults">
                    <div class="feedback-item pass">
                        <span class="icon" style="color:var(--success);">✅</span>
                        <div>**Action Verbs:** Strong use of action verbs (e.g., "Led," "Managed," "Developed") found in job descriptions.</div>
                    </div>
                    <div class="feedback-item fail">
                        <span class="icon" style="color:var(--danger);">❌</span>
                        <div>**Keyword Density:** Key industry terms are present but appear less frequently than recommended for optimal ranking in your field.</div>
                    </div>
                    <div class="feedback-item pass">
                        <span class="icon" style="color:var(--success);">✅</span>
                        <div>**Quantifiable Achievements:** Several bullet points use numbers and metrics to showcase impact, making results clear.</div>
                    </div>
                </div>
            </div>

            <div class="ats-section">
                <h3>⚙️ Technical Scan</h3>
                <div id="technicalResults">
                    <div class="feedback-item fail">
                        <span class="icon" style="color:var(--danger);">❌</span>
                        <div>**Contact Info:** The email address is slightly complex which could lead to parsing errors on some systems.</div>
                    </div>
                    <div class="feedback-item pass">
                        <span class="icon" style="color:var(--success);">✅</span>
                        <div>**File Type:** Submitted file type is ATS-friendly (PDF/DOCX).</div>
                    </div>
                </div>
            </div>
        </div>
        <div style="text-align:center; margin-bottom: 20px;">
            <button class="back back-to-welcome" onclick="showScreen('welcome')">Back to Home</button>
            <button class="next" onclick="showScreen('builder')">Edit Resume Based on Feedback</button>
        </div>
    </div>


    <div id="builder-app">
        <div class="form-section" role="region" aria-label="Resume Builder Form">
            <h2 id="formTitle">Contact Info</h2>

            <div class="stepper" aria-hidden="true">
                <div class="step-indicator active" id="step0bar"></div>
                <div class="step-indicator" id="step1bar"></div>
                <div class="step-indicator" id="step2bar"></div>
                <div class="step-indicator" id="step3bar"></div>
                <div class="step-indicator" id="step4bar"></div>
            </div>
            <div class="step-labels">
                <span>Contact</span><span>Exp</span><span>Edu</span><span>Skills</span><span>About</span>
            </div>

            <label>Choose Resume Style</label>
            <div class="style-selector" id="styleSelector">
                <div class="style-option active" data-style="style1" onclick="selectStyle(this)">
                    <img src="https://resumod.co/uploads/image-1664861027812.jpg" alt="Modern preview"/>
                    Modern
                </div>
                <div class="style-option" data-style="style2" onclick="selectStyle(this)">
                    <img src="https://cms-assets.tutsplus.com/cdn-cgi/image/width=850/uploads/users/988/posts/93140/image-upload/canva_black_white_minimalist_cv_resume.jpg" alt="Minimalist"/>
                    Minimalist
                </div>
                <div class="style-option" data-style="style3" onclick="selectStyle(this)">
                    <img src="https://cdn-blog.novoresume.com/articles/relevant-coursework-on-resume/relevant-coursework-resume.webp" alt="Classic"/>
                    Classic
                </div>
            </div>

            <div class="step active" id="step0">
                <div class="grid-two">
                    <input id="fname" placeholder="First Name" aria-label="First Name">
                    <input id="lname" placeholder="Last Name" aria-label="Last Name">
                </div>
                <div class="grid-two">
                    <input id="city" placeholder="City" aria-label="City">
                    <input id="postal" placeholder="Postal Code" aria-label="Postal Code">
                </div>
                <div class="grid-two">
                    <input id="phone" placeholder="Phone" aria-label="Phone">
                    <input id="email" placeholder="Email" aria-label="Email">
                </div>
                <label>Upload Photo</label>
                <input type="file" id="profilePicInput" accept="image/*" aria-label="Profile photo">
            </div>

            <div class="step" id="step1" style="display:none">
                <div id="experienceFields" aria-live="polite"></div>
                <button class="add" type="button" onclick="addExperience()">+ Add Experience</button>
            </div>

            <div class="step" id="step2" style="display:none">
                <div id="educationFields" aria-live="polite"></div>
                <button class="add" type="button" onclick="addEducation()">+ Add Education</button>
            </div>

            <div class="step" id="step3" style="display:none">
                <div id="skillsFields" aria-live="polite"></div>
                <button class="add" type="button" onclick="addSkill()">+ Add Skill</button>
            </div>

            <div class="step" id="step4" style="display:none">
                <input id="aboutName" placeholder="Full Name (About)" aria-label="About full name">
                <input id="aboutFather" placeholder="Father's Name" aria-label="Father's name">
                <textarea id="aboutHobbies" placeholder="Hobbies" aria-label="Hobbies"></textarea>
                <textarea id="aboutOther" placeholder="Other Details / Short Bio" aria-label="Short bio"></textarea>
            </div>

            <div style="margin-top:8px">
                <div class="controls-row">
                    <button class="back" onclick="prevStep()" aria-label="Go to previous step">Back</button>
                    <button class="next" onclick="nextStep()" aria-label="Go to next step">Next</button>
                    <button class="download" onclick="downloadPDF()" aria-label="Download as PDF">Download as PDF</button>
                </div>
            </div>
            <button class="back back-to-welcome" style="margin-top: 15px;" onclick="showScreen('welcome')">Back to Home</button>
        </div>

        <div class="preview-wrap" aria-label="Resume preview">
            <div id="resumePreview" class="style1" role="region" aria-label="Resume preview card">
                <div class="resume-inner">
                    <div class="left-col">
                        <img id="prevProfilePic" class="profile-pic" src="" alt="Profile picture" style="display:none;">
                        <h1 id="prevName">Your Name</h1>
                        <h2 id="prevContact">Email | Phone</h2>
                        <p id="prevLocation" class="meta">City, Postal Code</p>
                    </div>

                    <div class="right-col">
                        <div class="section">
                            <h3>Experience</h3>
                            <div id="prevExperience">Your work experience will appear here.</div>
                        </div>

                        <div class="section">
                            <h3>Education</h3>
                            <div id="prevEducation">Your education will appear here.</div>
                        </div>

                        <div class="section">
                            <h3>Skills</h3>
                            <ul id="prevSkills"><li>Your skills will appear here.</li></ul>
                        </div>

                        <div class="section">
                            <h3>About Me</h3>
                            <p><b>Name:</b> <span id="prevAboutName">-</span></p>
                            <p><b>Father's Name:</b> <span id="prevAboutFather">-</span></p>
                            <p><b>Hobbies:</b> <span id="prevAboutHobbies">-</span></p>
                            <p id="prevAboutOther">Your short bio will appear here.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>

    <script>
        // --- Screen Switching Logic ---
        function showScreen(screenId) {
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('builder-app').style.display = 'none';
            document.getElementById('analyzer-screen').style.display = 'none';
            document.getElementById('analysis-results-screen').style.display = 'none';

            if (screenId === 'builder') {
                document.getElementById('builder-app').style.display = 'flex';
                showStep(0); 
            } else if (screenId === 'analyzer') {
                document.getElementById('analyzer-screen').style.display = 'flex';
            } else if (screenId === 'analysis-results') {
                document.getElementById('analysis-results-screen').style.display = 'block';
            } else if (screenId === 'welcome') {
                document.getElementById('welcome-screen').style.display = 'flex';
            }
        }

        // --- Original Resume Builder Logic ---

        // Steps logic
        let currentStep = 0;
        const steps = Array.from(document.querySelectorAll('.step'));
        const titles = ['Contact Info','Experience','Education','Skills','About'];

        function showStep(n){
            // bounds
            if(n < 0) n = 0;
            if(n >= steps.length) n = steps.length - 1;
            currentStep = n;

            steps.forEach((s,i)=>{
                if(i === n){
                    s.style.display = '';
                    s.classList.add('active');
                } else {
                    s.style.display = 'none';
                    s.classList.remove('active');
                }
            });

            document.getElementById('formTitle').innerText = titles[n];

            // stepper bars
            document.querySelectorAll('.step-indicator').forEach((bar,i)=>{
                bar.classList.toggle('active', i <= n);
            });
        }

        function nextStep(){ if(currentStep < steps.length - 1) showStep(currentStep + 1); updatePreview(); }
        function prevStep(){ if(currentStep > 0) showStep(currentStep - 1); updatePreview(); }

        // add dynamic fields
        function addExperience(){
            const container = document.getElementById('experienceFields');
            const div = document.createElement('div');
            div.style.marginBottom = '12px';
            div.innerHTML = `
                <input placeholder="Job Title" class="expTitle" aria-label="Job Title">
                <input placeholder="Company" class="expCompany" aria-label="Company">
                <input placeholder="Years (e.g. 2020-2023)" class="expYears" aria-label="Years">
                <textarea placeholder="Description" class="expDesc" aria-label="Description"></textarea>
                <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:6px">
                    <button class="remove" type="button">Remove</button>
                </div>
                <hr>`;
            container.appendChild(div);

            // attach remove handler and update preview on input
            const inputs = div.querySelectorAll('input, textarea');
            inputs.forEach(input => input.addEventListener('input', updatePreview));
            div.querySelector('.remove').addEventListener('click', () => { div.remove(); updatePreview(); });
            updatePreview();
        }

        function addEducation(){
            const container = document.getElementById('educationFields');
            const div = document.createElement('div');
            div.style.marginBottom = '12px';
            div.innerHTML = `
                <input placeholder="Degree / Course" class="eduDegree" aria-label="Degree or Course">
                <input placeholder="Institution" class="eduInstitution" aria-label="Institution">
                <input placeholder="Years (e.g. 2018-2022)" class="eduYears" aria-label="Years">
                <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:6px">
                    <button class="remove" type="button">Remove</button>
                </div>
                <hr>`;
            container.appendChild(div);
            const inputs = div.querySelectorAll('input, textarea');
            inputs.forEach(input => input.addEventListener('input', updatePreview));
            div.querySelector('.remove').addEventListener('click', () => { div.remove(); updatePreview(); });
            updatePreview();
        }

        function addSkill(){
            const container = document.getElementById('skillsFields');
            const div = document.createElement('div');
            div.style.marginBottom = '12px';
            div.innerHTML = `
                <input placeholder="Skill" class="skillName" aria-label="Skill Name">
                <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:6px">
                    <button class="remove" type="button">Remove</button>
                </div>
                <hr>`;
            container.appendChild(div);
            const inputs = div.querySelectorAll('input, textarea');
            inputs.forEach(input => input.addEventListener('input', updatePreview));
            div.querySelector('.remove').addEventListener('click', () => { div.remove(); updatePreview(); });
            updatePreview();
        }

        // profile image preview
        document.getElementById('profilePicInput').addEventListener('change', function(e){
            const f = e.target.files && e.target.files[0];
            if(!f) return;
            const rdr = new FileReader();
            rdr.onload = function(ev){
                const img = document.getElementById('prevProfilePic');
                img.src = ev.target.result;
                img.style.display = 'block';
            }
            rdr.readAsDataURL(f);
        });

        // preview update
        function escapeHtml(str){
            if(!str) return '';
            return String(str).replace(/[&<>"']/g, function(m){
                return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m];
            });
        }

        function updatePreview(){
            // Contact fields
            const fname = document.getElementById('fname').value || '';
            const lname = document.getElementById('lname').value || '';
            const city = document.getElementById('city').value || '';
            const postal = document.getElementById('postal').value || '';
            const phone = document.getElementById('phone').value || '';
            const email = document.getElementById('email').value || '';

            document.getElementById('prevName').innerText = (fname + ' ' + lname).trim() || 'Your Name';
            document.getElementById('prevContact').innerText = (email || '') + (email && phone ? ' | ' : '') + (phone || '');
            document.getElementById('prevLocation').innerText = city + (postal ? ', ' + postal : '');

            // Experience
            let expHtml = '';
            document.querySelectorAll('#experienceFields > div').forEach(div => {
                const title = (div.querySelector('.expTitle') || {value:''}).value.trim();
                const company = (div.querySelector('.expCompany') || {value:''}).value.trim();
                const years = (div.querySelector('.expYears') || {value:''}).value.trim();
                const desc = (div.querySelector('.expDesc') || {value:''}).value.trim();

                if(title || company || years || desc){
                    expHtml += `<p><strong>${escapeHtml(title)}</strong>${company ? ' — ' + escapeHtml(company) : ''}${years ? ' <span style="color:var(--muted)">(' + escapeHtml(years) + ')</span>' : ''}<br>${escapeHtml(desc).replace(/\n/g, '<br>')}</p>`;
                }
            });
            document.getElementById('prevExperience').innerHTML = expHtml || 'Your work experience will appear here.';

            // Education
            let eduHtml = '';
            document.querySelectorAll('#educationFields > div').forEach(div => {
                const degree = (div.querySelector('.eduDegree') || {value:''}).value.trim();
                const inst = (div.querySelector('.eduInstitution') || {value:''}).value.trim();
                const years = (div.querySelector('.eduYears') || {value:''}).value.trim();

                if(degree || inst || years){
                    eduHtml += `<p><strong>${escapeHtml(degree)}</strong>${inst ? ' — ' + escapeHtml(inst) : ''}${years ? ' <span style="color:var(--muted)">(' + escapeHtml(years) + ')</span>' : ''}</p>`;
                }
            });
            document.getElementById('prevEducation').innerHTML = eduHtml || 'Your education will appear here.';

            // Skills
            let skillsHtml = '';
            document.querySelectorAll('#skillsFields > div').forEach(div => {
                const s = (div.querySelector('.skillName') || {value:''}).value.trim();
                if(s) skillsHtml += `<li>${escapeHtml(s)}</li>`;
            });
            document.getElementById('prevSkills').innerHTML = skillsHtml || '<li>Your skills will appear here.</li>';

            // About
            document.getElementById('prevAboutName').innerText = document.getElementById('aboutName').value || '-';
            document.getElementById('prevAboutFather').innerText = document.getElementById('aboutFather').value || '-';
            document.getElementById('prevAboutHobbies').innerText = document.getElementById('aboutHobbies').value || '-';
            document.getElementById('prevAboutOther').innerText = document.getElementById('aboutOther').value || 'Your short bio will appear here.';
        }

        // live update on input
        document.addEventListener('input', updatePreview);

        // style selector
        function selectStyle(el){
            const style = el.dataset.style;
            const resume = document.getElementById('resumePreview');
            // remove known style classes
            resume.classList.remove('style1','style2','style3');
            // add selected style
            resume.classList.add(style);

            // mark thumbnail active
            document.querySelectorAll('.style-option').forEach(o => o.classList.remove('active'));
            el.classList.add('active');

            updatePreview();
        }

        // PDF download using html2pdf
        function downloadPDF(){
            const resume = document.getElementById('resumePreview');

            // clone and adjust for a clean PDF snapshot (avoid bleed from page)
            const clone = resume.cloneNode(true);
            clone.style.transform = 'scale(1)';
            clone.style.width = '800px';
            clone.style.margin = '0 auto';
            const wrapper = document.createElement('div');
            wrapper.style.padding = '18px';
            wrapper.style.background = '#fff';
            wrapper.appendChild(clone);

            const opt = {
                margin: 0.4,
                filename: 'My_Resume.pdf',
                image: { type: 'jpeg', quality: 1 },
                html2canvas: { scale: 2, useCORS: true, logging: false },
                jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().from(wrapper).set(opt).save();
        }


        // initialize
        (function init(){
            // Attach click handler for "Analyze Now" button
            document.getElementById('analyzeNowButton').addEventListener('click', function() {
                const fileInput = document.getElementById('analyzerFileInput');
                if (fileInput.files.length > 0) {
                    // Simulate analysis time (optional, but good UX)
                    this.innerText = 'Analyzing...';
                    this.disabled = true;

                    // MOCK AI Analysis - simulates a successful response and shows results
                    setTimeout(() => {
                        this.innerText = 'Analyze Now';
                        this.disabled = false;
                        showScreen('analysis-results'); 
                    }, 1500); // 1.5 second delay for a realistic 'processing' feel
                } else {
                    alert('Please upload a resume file first.');
                }
            });

            // start on the welcome screen
            showScreen('welcome');
            
            // ensure first style option active for builder
            const first = document.querySelector('.style-option[data-style="style1"]');
            if(first) first.classList.add('active');
            document.getElementById('resumePreview').classList.add('style1');
            updatePreview();
        })();
    </script>
</body>
</html>